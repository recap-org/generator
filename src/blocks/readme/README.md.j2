# RECAP Template: {{ language | title }} - {{ size | title }}

## Purpose

This repository is a **[RECAP](https://recap-org.github.io)** template for **{{ size }} academic data projects using R**, such as {% if size == 'small' %}homework assignments, short analyses, or exploratory reports{% elif size == 'medium' %}final course projects, applied methods assignments, or replication exercises using raw data{% elif size == 'large' %}theses, working papers, collaborative research projects, or long-term replication efforts{% endif %}.

It provides a ready-to-use project structure and a reproducible execution environment that can be run:
- directly in the browser (e.g., GitHub Codespaces),
- or locally in common IDEs such as VS Code, Positron, or RStudio.

For guidance on how to run this template, choose an environment, or collaborate with others, see the main [RECAP documentation](https://recap-org.github.io).

## Getting started

To get started, click the **Use this template** button above the file list ⬆️.

You have two options: 

### Try it out online (without saving your work)

1. Select **Open in a codespace**. 
2. Wait for the codespace to be created and started. **This may take up to 5 minutes.** ☕
3. Once the codespace is ready, you can follow the instructions in the **Basic demo** section below.

### Make your own copy (to save your work)

If you want to keep working on this project (locally or in the cloud), create your own copy of the template.

The RECAP documentation explains:
- how to create your own repository,
- how to run the template locally or in an isolated environment,
- and how to choose the setup that fits your needs.

➡️ See **[How to run a RECAP template](https://recap-org.github.io/docs/running-templates/)** on the RECAP website.

## Demo

{% if language == 'r' %}
{% if setup is not none %}
First, install the R packages used in this template. Open a terminal and type:

```bash
{{ setup }}
```
{% else %}
We use [renv](https://rstudio.github.io/renv/) to record the R packages used in the project. If you are running this template locally, make sure the `renv` package is installed and use it to restore the packages associated with the template. Open a terminal and type: 

```bash
Rscript -e "renv::restore()"
```

If you are running this template on GitHub Codespaces or in an isolated environment (Docker), you can skip this step; it was executed automatically as the environment was being put together. 
{% endif %}

{% if size == 'small' %}
Open `./src/main.qmd` and hit the Preview button (top right corner) or press `Cmd + Shift + K` to render the report. You will find an HTML report with some basic data analysis and a photo in `./out/src/main.html`.
{% elif size == 'medium' %}
Then, open a terminal and type: 

```bash
{{ run }}
```

This will execute the data cleaning step in `./src/data.qmd`, then render the report in `./src/main.qmd`. You will find a PDF report with some basic data analysis and a photo in `./out/src/main.pdf`.
{% elif size == 'large' %}
Then, open a terminal and type: 

```bash
{{ run }}
```

This will execute the data cleaning step by running all the files `./src/data`, then the analysis by running all the files in `./src/analysis`, the compile the tex files in `./tex`. You will find the final documents (an article, its appendix, and a presentation) in the `./out/tex` directory and intermediary reports of the data cleaning and analysis steps in the `./out/src` directory.
{% endif %}
{% endif %}

## Using this template

This template is organized as follows

```bash
├── LICENSE # license file
├── README.md # this file
├── assets
{% if size == 'medium' or size == 'large' %}
│   ├── figures # where generated figures go (not committed to git)
│   ├── tables # where generated tables go (not committed to git)
{% endif %}
│   ├── static # where external images and other static assets live (committed to git)
│   └── references.bib # latex bibliography file (committed to git)
{% if size == 'small '%}
├── data # raw data goes here (committed to git)
{% elif size == 'medium' or size == 'large' %}
├── data
│   ├── raw # raw data goes here (committed to git)
│   └── processed # processed data goes here (not committed to git)
{% endif %}
├── src # all the code goes here
{% if size == 'small' %}
│   ├── main.qmd # generate the final report
{% elif size == 'medium' %}
│   ├── data.qmd # process raw data into clean data
│   ├── main.qmd # generate the final report
{% elif size == 'large' %}
│   ├── data # scripts that process raw data into clean data
│   ├── main # scripts that generate do the analysis
{% endif %}
│   └── lib # helper functions
{% if size == 'small' %}
├── out # where your generated report is stored (not committed to git)
{% elif size == 'medium '%}
├── out # where your generated report is stored (not committed to git)
{% elif size == 'large '%}
├── out # where generated outputs are stored (not committed to git)
{% endif %}
├── _quarto.yaml # configuration for Quarto
├── .lintr # configuration for R linting
{% if size == 'large' %}
├── renv.lock # renv lockfile; records packages used in the project
├── renv # renv data
├── .Rprofile # launches renv when opening an R session
├── _vscode.R # R packages required for a pleasant experience with VS Code
{% endif %}
└── .devcontainer # configuration for the containerized environment
```

{% if size == 'small'%}
### Producing the report

The file `./src/main.qmd` produces the final report. It generates an HTML file at `./out/src/main.html`.
{% elif size == 'medium'%}
### Producing the report

This template uses `make` to orchestrate the different steps of the analysis.  
If you are not familiar with `make`, we strongly recommend reading the following page first: [Building your project with make](https://recap-org.github.io/docs/building-with-make)

What follows focuses on how this template is structured, not on how `make` works internally.

#### Step 1: cleaning raw data

Raw data should be placed in the `./data/raw` directory and committed to git (unless it is very large, in which case you should consider alternative storage solutions).

The file `./src/data.qmd` turns raw data into clean, processed data.  
The processed data is written to the `./data/processed` directory.

We use a Quarto document for this step for several reasons:

- it produces a single, traceable output (`.pdf`) that can be used in build pipelines,
- it provides readable command-line output,
- it supports caching, which can dramatically speed up re-execution.

#### Step 2: producing the report

The file `./src/main.qmd` uses the processed data to produce the final report.  
It generates a PDF at `./out/src/main.pdf`.

### Running the full analysis

To run the full analysis from scratch, use:

```bash
make
```

This command executes both steps in the correct order:
1. compile `./src/data.qmd`,
2. compile `./src/main.qmd`.

Every RECAP template also provides a built-in way to discover available commands.  
If you are unsure how to interact with the project, start by running:

```bash
make
```

You can customize `./Makefile` to change how the build steps are executed.  
For an overview of the design principles behind this setup, see the `make` documentation linked above.
{% elif size == 'large' %}
### Producing the paper, appendix and presentation

This template uses `make` to orchestrate a multi-stage analysis pipeline.  
Before modifying the build system, we strongly recommend reading: [Building your project with make](https://recap-org.github.io/docs/building-with-make)

#### Running the full analysis

To run the entire pipeline from scratch, use:

```bash
make
```

This command will:
1. process the data (`./src/data`),
2. run the analysis (`./src/analysis`),
3. compile the LaTeX documents (`./tex`).

Every RECAP large template also provides a `make help` command that lists the supported build targets and utility commands.  
If you are unsure how the project is meant to be used, this is always the right starting point.

You can customize the `./Makefile` to adapt the pipeline to your needs.  
For a conceptual overview of how RECAP uses `make` at this scale, refer back to the documentation page linked above.

The rest of this section explains how the large template is organized and how your code should fit into that structure.

#### Step 1: cleaning raw data

Raw data should be placed in the `./data/raw` directory and committed to git (unless it is very large, in which case you should consider alternative storage solutions).

Data-cleaning code should consist of a series of Quarto `.qmd` scripts placed in the `./src/data` directory.  
These scripts produce clean, analysis-ready datasets, stored in `./data/processed`.

To leverage the automated build pipeline, each script should be able to run independently (that is, scripts should not depend on one another).

Using Quarto at this stage ensures that each step produces a single, traceable output that integrates cleanly with the build system.

#### Step 2: doing the analysis

Analysis code should be placed in the `./src/analysis` directory as a series of Quarto `.qmd` scripts.

These scripts:
- take processed data from `./data/processed` as input,
- produce tables and figures stored in `./assets/tables` and `./assets/figures`.

The template provides helper functions for this purpose (for example, to save figures and tables in a consistent way). These functions live in `./src/lib/io.R`.

As in the data step, analysis scripts should be written so they can run in parallel.

#### Step 3: compiling the LaTeX documents

Each LaTeX document lives in its own subdirectory of `./tex`.  
The main file of each document must be called `main.tex`.

LaTeX documents use symlinks to the shared `./assets` directory so that tables, figures, and bibliographic resources can be reused across documents. 

A symlink is simply a reference to another folder. It does not duplicate files — it just points to them. This allows every LaTeX project to access the same assets without copying them.

You normally do not need to manage these links manually.

If you add a new LaTeX project (a new subdirectory under `./tex`), run:

```bash
make symlinks
```

This will automatically create the required symlinks.

If symlink creation fails, make sure you are working inside the development container, where symlinks are fully supported.
{% endif %}

### External assets

A project may also use assets that are not generated by code (e.g., external images, bibliography, ...). These should be placed in `./assets/static` and committed to git. 

### Helper functions

Helper functions are shared across your data and analysis code. They are declared in `.R` files that are placed in `./src/lib`. Think of these helper functions as a quasi-R package that accompanies the project. As such, each of these functions should be properly documented so that all collaborators understand how they work.  

{% if size == 'medium' or size =='large'%}
### Tests

This template includes a basic testing setup using the `testthat` package.

If you are not familiar with how testing works in RECAP, we recommend first reading our [documentation on tests](https://recap-org.github.io/docs/tests).

All test files must:

- live in the `tests/` directory, and
- have filenames that start with `test-`.

To run all tests, use:

```bash
make tests
```

For details on writing tests, see the official `testthat` [documentation](https://testthat.r-lib.org/).

{% endif %}
{% if size == 'large' %}
### Dependency management

This template uses explicit dependency management for R packages.

If you are not familiar with dependency management in RECAP, we recommend first reading our [documentation on dependency management](https://recap-org.github.io/docs/dependency-management)

We use the `renv` package to record the exact R package versions required by the project. This is enabled by default, as it is good practice for long-running, complex research projects. For detailed documentation on `renv`, see its [documentation](https://rstudio.github.io/renv/). 

For implementation details about how `renv` is configured inside the development container
(e.g. use of `pak`, cache handling), see the comments in `.devcontainer/devcontainer.json`.

If you prefer not to use explicit dependency management, you can remove it as follows:

- Delete `./renv.lock`, `./renv`, and `./.Rprofile`.
- In `.devcontainer/devcontainer.json`, comment out the line:

  `"postCreateCommand": "Rscript -e 'renv::restore()'"`

  This disables automatic restoration of R package versions when the container is created.

{% endif %}
### Configuration

Look into the following files to tweak things as you see fit: 

- `./.lintr`: R linting options
- `./_quarto.yaml`: Quarto options; we provide a set of sane defaults
{% if size == 'medium' or size == 'large' %}
- `./Makefile`: customize how build steps are executed
{% endif %}

## Software environment

This template comes with a reproducible execution environment that includes R, Quarto,{% if size == 'medium' or size == 'large' %}LaTeX,{% endif %} and other useful tools. We rely on the [Dev Container](https://code.visualstudio.com/docs/devcontainers/containers) specification, which means that you can extend the environment by editting `./.devcontainer/devcontainer.json`.

The exact software stack (including versions) is documented in the **[RECAP {{release}} image release](https://github.com/recap-org/images/releases/tag/{{release}})**.

This information is mainly useful if you need to check versions or debug environment-specific issues.  
You do not need to understand or modify this to use the template.

## Issues and feedback

If something doesn't work as expected, or if you have a suggestion for improving this template, please open an issue on this repository (Issue tab ⬆️).

You don't need to be sure that something is "really a bug" — unclear instructions, confusing behavior, or small setup problems are all worth reporting. Your feedback helps improve RECAP for everyone.

## Credits

We thank 

- [Jason Leung](https://unsplash.com/@ninjason?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash) on [Unsplash](https://unsplash.com/photos/donkey-kong-arcade-game-screen-with-1981-date-c5tiCWrZADc?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash) for that nice Donkey Kong photo.
- [grandmaster07](https://www.kaggle.com/grandmaster07) for the student exam score dataset analysis published on [Kaggle](https://www.kaggle.com/datasets/grandmaster07/student-exam-score-dataset-analysis)
