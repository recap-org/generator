// For format details, see https://aka.ms/devcontainer.json. 
{
    "name": "recap-template-{{ language }}-{{ size }}",
    "image": "ghcr.io/recap-org/{{ language }}:{{ release }}",
    // ðŸ‘‡ Features to add to the Dev Container. More info: https://containers.dev/implementors/features.
    // "features": {},
    // ðŸ‘‡ Configure tool-specific properties.
    "customizations": {
        "vscode": {
            "extensions": [
                {% if language == 'r' %}
                "RDebugger.r-debugger",
                "REditorSupport.r",
                "quarto.quarto",
                {% endif %}
                "James-Yu.latex-workshop"
            ],
            "settings": {
                {% if language == 'r' %}
                "r.bracketedPaste": true,
                "r.rterm.linux": "/usr/local/bin/radian",
                "r.plot.useHttpgd": true,
                {% endif %}
                "latex-workshop.formatting.latex": "tex-fmt"
            }
        }
    },
    {% if language == 'r' and size == 'large' %}
    // ðŸ‘‡ restore renv packages upon container creation
    "postCreateCommand": "Rscript -e 'renv::restore()'",
    "containerEnv": {
        // ðŸ‘‡ use pak for automatic installation of system dependencies
        "RENV_CONFIG_PAK_ENABLED": "TRUE", 
        // ðŸ‘‡ store renv package cache in /renv/cache 
        // (avoids cluttering the container user's home folder)
        "RENV_PATHS_CACHE": "/renv/cache"
    },
    {% endif %}
    // ðŸ‘‡ Bind local folders into the container
    "mounts": [
        // Mount a folder containing external raw data into the project's data/raw folder.
        // "source=${localEnv:HOME}${localEnv:USERPROFILE}/data,target=${containerWorkspaceFolder}/data/raw,type=bind,consistency=cached",
        // Mount a volume containing external raw data into the project's data/raw folder.
        // "source=volume-name,target=${containerWorkspaceFolder}/data/raw,type=volume",
        {% if language == 'r' and size == 'large' %}
        // Shared cache of renv packages
        "source=devcontainer-renv-cache,target=/renv/cache,type=volume"
        {% endif %}
    ]
}