// For format details, see https://aka.ms/devcontainer.json. 
{
    "name": "recap-template-{{ language }}-{{ size }}",
    "image": "ghcr.io/recap-org/{{ language }}:{{ release }}",
    // ðŸ‘‡ Features to add to the Dev Container. More info: https://containers.dev/implementors/features.
    // "features": {},
    // ðŸ‘‡ Configure tool-specific properties.
    "customizations": {
        "vscode": {
            "extensions": [
                {% if language == 'r' %}
                "RDebugger.r-debugger",
                "REditorSupport.r",
                "quarto.quarto",
                {% endif %}
                {% if language == 'stata' %}
                "kylebarron.stata-enhanced",
                {% endif %}
                "James-Yu.latex-workshop"
            ],
            "settings": {
                "terminal.integrated.defaultProfile.linux": "zsh",
                {% if language == 'r' %}
                "r.bracketedPaste": true,
                "r.rterm.linux": "/usr/local/bin/radian",
                "r.plot.useHttpgd": true,
                {% endif %}
                "latex-workshop.formatting.latex": "tex-fmt"
            }
        }
    },
    {% if langage=='stata' %}
    "forwardedPorts": [ 10000 ],
    {% endif %}
    {% if language == 'r' and size == 'large' %}
    // ðŸ‘‡ restore renv packages upon container creation
    "postCreateCommand": "Rscript -e 'renv::restore()'",
    "containerEnv": {
        // ðŸ‘‡ use pak for automatic installation of system dependencies when 
        // restoring R packages with renv
        "RENV_CONFIG_PAK_ENABLED": "TRUE", 
        // ðŸ‘‡ store renv package cache in /renv/cache 
        // (avoids cluttering the container user's home folder)
        "RENV_PATHS_CACHE": "/renv/cache"
    },
    {% endif %}
    // ðŸ‘‡ Bind local folders into the container
    "mounts": [
        // ðŸ‘‡ Mount a folder containing external raw data into the project's data/raw folder.
        // "source=${localEnv:HOME}${localEnv:USERPROFILE}/data,target=${containerWorkspaceFolder}/data/raw,type=bind,consistency=cached",

        // ðŸ‘‡ Mount a volume containing external raw data into the project's data/raw folder.
        // "source=volume-name,target=${containerWorkspaceFolder}/data/raw,type=volume",
        {% if language == 'stata' %}
        
        // ðŸ‘‡ direct Stata to the location of its license
        "source=${localWorkspaceFolder}/stata.lic,target=/usr/local/stata/stata.lic,type=bind,consistency=cached"
        {% endif %}
        {% if language == 'r' and size == 'large' %}
        
        // ðŸ‘‡ Optional: mount shared renv cache volume to avoid reinstalling
        // packages across dev containers. This improves performance but
        // does not affect reproducibility (renv.lock governs versions).
        // "source=devcontainer-renv-cache,target=/renv/cache,type=volume"
        {% endif %}
    ]
}